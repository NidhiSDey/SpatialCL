# Spatial Transcriptomics Analysis of Ethiopian Cutaneous Leishmaniasis

This repository contains the complete analysis code for our study characterizing the spatial immune landscape of Ethiopian cutaneous leishmaniasis (CL) using 10x Visium spatial transcriptomics.

## Overview

Ethiopian cutaneous leishmaniasis shows remarkably heterogeneous clinical presentations, but the underlying immunopathological mechanisms driving this heterogeneity remain poorly understood. This study uses spatial transcriptomics to characterize the local immune response in paired lesional and non-lesional skin biopsies from five Ethiopian CL patients.

### Key Findings

We identified **five spatially distinct immunopathological responses** that can co-exist within individual lesions:

1. **Epithelial hyperplasia** with interferon-stimulated keratinocytes
2. **Cytotoxicity** with tertiary lymphoid structures
3. **Granulomatous inflammation** with proinflammatory response
4. **Granulomatous inflammation** with M2-polarized myeloid cell responses
5. **Fibrotic remodeling** with active collagen synthesis

These fundamental tissue programs, alone or in combination, may be associated with the diverse clinical presentations observed in cutaneous leishmaniasis patients.

## Study Design

- **Technology**: 10x Visium spatial transcriptomics (55μm spot-based transcriptomes)
- **Samples**: 5 patients with paired lesional (L) and non-lesional (NL) skin punch biopsies (10 samples total)
- **Organism**: Human (*Homo sapiens*)
- **Approach**: Reference-free deconvolution, morphology-guided regional analyses, and immunohistochemistry

## Repository Structure

```
.
├── README.md
├── annotations/           # Manual tissue region annotations (CSV files)
│   │   ├── P3_GRANULOMAS.csv
│   │   ├── Organized_Granulomas_v2.csv
│   │   ├── Diffuse_Immune.csv
│   │   ├── Uninvolved.csv
│   │   ├── Keratinocytes.csv
│   │   ├── All_Keratinocyte.csv
│   │   └── Keratinocyte_subclass.csv
│   └── processed/             # NOTE: Large .rds files not included in repo
├── scripts/
│   ├── Script1_Seurat_integration_clustering_addclinicalmetadata.Rmd
│   ├── Script1_Plots.Rmd
│   ├── Script2_Stdeconvolve_allsamples_L_NL_combined.Rmd
│   ├── Script2_plots.Rmd
│   ├── Script3_Stdeconvolve_lesion.Rmd
│   ├── Script3_Plots.Rmd
│   ├── Script4_P1_L.Rmd
│   ├── Script5_P2_L.Rmd
│   ├── Script6_P3L_granuloma_antigen_presentation.Rmd
│   ├── Script7_P4L.Rmd
│   └── Script8_P5_L.Rmd
```

## Analysis Workflow

### Pipeline Overview

The analysis follows this sequential workflow:

```
Raw FASTQ files
    ↓
[Space Ranger alignment]
    ↓
Script 1: Integration & Clustering → Eth4mm_renamed_res_addedabundances_pid_sampleid_tratio0.6dims1_15_cohort.rds
    ↓
Script 2: STdeconvolve (all samples) → Combined_integrated_Eth_cohort_obj_26top_domcell_added.rds
    ↓
Script 3: STdeconvolve (lesions only) → Lesion_integrated_Eth_cohort_filtered_35_stdeconvTopics_reclus_relabelled_COMBINED_dominantTopic_added.rds
    ↓
Scripts 4-8: Patient-specific analyses
```

### Script Descriptions

| Script | Description | Figure Outputs | Key Seurat Object Output |
|--------|-------------|----------------|--------------------------|
| **Script 1** | Seurat integration, clustering, clinical metadata | Figure 2, Supplementary Figure 1 | `integrated_Eth_cohort_filtered_23stdeconvTopics_labelled.rds` |
| **Script 2** | STdeconvolve deconvolution (all samples: L + NL) | Figure 2, Supplementary Figure 1 | `Combined_integrated_Eth_cohort_obj_26top_domcell_added.rds` |
| **Script 3** | STdeconvolve deconvolution (lesions only) | Figure 3, Supplementary Figure 2, Supplementary Table 2 | `Lesion_integrated_Eth_cohort_filtered_35stdeconvTopics_reclus_relabelled_COMBINED_dominantTopic_added.rds` |
| **Script 4** | Patient 1 lesion analysis | Figure 4, Supplementary Figure 3 | - |
| **Script 5** | Patient 2 lesion analysis | Figure 5, Supplementary Figure 4 | - |
| **Script 6** | Patient 3 granuloma & antigen presentation | Figure 6, Supplementary Figure 5 | - |
| **Script 7** | Patient 4 lesion analysis | Figure 7, Supplementary Figure 6 | - |
| **Script 8** | Patient 5 lesion analysis | Figure 8, Supplementary Figure 7 | - |

### Key Intermediate Files

**Required Seurat Objects** (available upon request or from GEO):

1. **Lesion-only analysis** (35 STdeconvolve topics):
   - `Lesion_integrated_Eth_cohort_filtered_35_stdeconvTopics_reclus_relabelled_COMBINED_dominantTopic_added.rds`
   - Generated by: Script 3
   - Used by: Scripts 4-8 (all patient-specific analyses)
   - Contains: 5 patient lesion samples (P1_L, P2_L, P3_L, P4_L, P5_L)

2. **Combined lesion + non-lesional** (26 topics):
   - `Combined_integrated_Eth_cohort_obj_26top_domcell_added.rds`
   - Generated by: Script 2
   - Used by: Script 4 (P1 L vs NL), Script 8 (P5 L vs NL epidermis)
   - Contains: All 10 samples (lesional and non-lesional)

**Manual Annotation Files** (CSV format):

- `P3_GRANULOMAS.csv` - Granuloma region annotations for Patient 3
- `Organized_Granulomas_v2.csv`, `Diffuse_Immune.csv`, `Uninvolved.csv` - Tissue category annotations for Patient 4
- `Keratinocytes.csv`, `All_Keratinocyte.csv`, `Keratinocyte_subclass.csv` - Epidermal annotations for Patient 5

## Installation

### Prerequisites

- **R version**: 4.5.0 or higher
- **Operating System**: Linux, macOS, or Windows
- **Memory**: Recommended 16GB+ RAM for handling Seurat objects

### Setup

1. Clone this repository:
```bash
git clone https://github.com/yourusername/ethiopian-cl-spatial-transcriptomics.git
cd ethiopian-cl-spatial-transcriptomics
```

2. Install required R packages:
```r
# Install Bioconductor if not already installed
if (!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager")

# Core dependencies
install.packages(c("Seurat", "ggplot2", "ggpubr", "scatterpie", "dplyr", "tibble", "tidyr"))
BiocManager::install(c("STdeconvolve", "ComplexHeatmap"))

# Additional packages
install.packages("devtools")
devtools::install_github("enblacar/SCpubr")
```

### Major Dependency List

All analyses were performed in **R version 4.5.0** with:

| Package | Version |
|---------|---------|
| Seurat | 5.3.0 |
| STdeconvolve | 1.3.2 |
| SCpubr | 3.0.0 |
| ComplexHeatmap | 2.24.1 |
| scatterpie | 0.2.6 |
| ggpubr | 0.6.0 |
| ggplot2 | 3.5.2 |
| patchwork | 1.3.0 |
| rstatix | 0.7.2 |
| tidyr | 1.3.1 |
| dplyr | 1.1.4 
  
## Data Availability

### Raw Data

- **Raw sequencing data (FASTQ)**: Available at NCBI GEO under accession  *(to be released upon publication)*
- **Processed Seurat objects**: Available from Zenodo or by request to corresponding author

### How to Access

1. Download raw FASTQ files from GEO
2. Run Space Ranger (10x Genomics) for alignment:
```bash
spaceranger count --id=sample_name \
                  --transcriptome=/path/to/refdata-gex-GRCh38-2024-A \
                  --fastqs=/path/to/fastqs \
                  --image=/path/to/tissue_image.tif \
                  --slide=slide_serial \
                  --area=capture_area
```

3. Or download processed Seurat objects directly from GEO supplementary files

## Usage

### Running the Complete Analysis

**Option 1: Sequential workflow (recommended for first-time users)**

```r
# Step 1: Integration and clustering
source("scripts/Script1_Seurat_integration_clustering_addclinicalmetadata.Rmd")
source("scripts/Script1_Plots.Rmd")

# Step 2: Deconvolution (all samples)
source("scripts/Script2_Stdeconvolve_allsamples_L_NL_combined.Rmd")
source("scripts/Script2_plots.Rmd")

# Step 3: Deconvolution (lesion-specific)
source("scripts/Script3_Stdeconvolve_lesion.Rmd")
source("scripts/Script3_Plots.Rmd")

# Step 4-8: Patient-specific analyses (can be run independently)
source("scripts/Script4_P1_L.Rmd")
source("scripts/Script5_P2_L.Rmd")
source("scripts/Script6_P3L_granuloma_antigen_presentation.Rmd")
source("scripts/Script7_P4L.Rmd")
source("scripts/Script8_P5_L.Rmd")
```

**Option 2: Individual patient analysis**

If you're only interested in specific patients, you can run Scripts 4-8 independently after obtaining the processed seurat object from zenodo

```r
# Load the lesion-specific Seurat object
seurat_obj <- readRDS("Lesion_integrated_Eth_cohort_filtered_35_stdeconvTopics_reclus_relabelled_COMBINED_dominantTopic_added.rds")

# Run patient-specific script
source("scripts/Script4_P1_L.Rmd")  # Replace with desired patient
```

### Note on Manual Annotations

Some analyses (Scripts 6-8) require manual tissue region annotations. These CSV files are provided in `data/annotations/` and should be loaded within the respective scripts.


## Citation

If you use this code or data, please cite:

```
[To be added upon publication]
```

## Contact

For questions about the code or data, please contact:
- **Corresponding Author**: paul.kaye@york.ac.uk and nidhi.dey@york.ac.uk
- **Code Repository Issues**: https://github.com/yourusername/ethiopian-cl-spatial-transcriptomics/issues

## License

This project is licensed under the MIT License - see the LICENSE file for details.

## Acknowledgments

- 10x Genomics for Visium spatial transcriptomics platform
- Ethiopian patients who participated in this study
- This work was supported by funding from the Dioraphte Foundation and Wellcome Trust Investigator Award.
---

**Last Updated**: 03/02/2026
**DOI**: 
